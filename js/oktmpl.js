(function(){function o(n,t){return n.slice(0,t.length)==t}function s(n){var t={'"':'\\"',"\n":"\\n","\r":"\\r","\\":"\\\\"};return n.replace(/[\"\\\n\r]/g,function(n){return t[n]})}function h(n){var t=n.charCodeAt(0);return t>47&&t<58||t==39||t==34||n=="true"||n=="false"}function t(n){function f(){n!==undefined&&this.resolve(n)}var r,i,u;return f.prototype={then:function(f){return r=f,i=new t,u&&this.resolve(n),i},resolve:function(t){if(u=!0,n=t,r){var f=r(n);f&&f.then?f.then(function(n){i.resolve(n)}):i.resolve(f)}}},new f}function l(){function f(){n<=0&&i&&u.resolve()}function e(){}var i=!1,u=new t,n=0;return e.prototype={open:function(){return'out += "'},close:function(){return'";'},addPromise:function(t){++n;t.then(function(){--n;f()})},wait:function(){return i=!0,f(),u},scopedExpr:r},new e}function a(n){function t(n,i){for(var u="(function (x) { var o = x;",r;r=n.shift();){if(h(r))return r;if(r=="]")break;r=="["?(r=t(n,"(x)"),n[0]=="]"&&n.shift()):r='"'+r+'"';u+="o && (o = o["+r+"]);"}return u+"return o; })"+(i||"")}return t(n.match(/\[|\]|\"[^"\\]*(?:\\.[^"\\]*)*\"|\'[^'\\]*(?:\\.[^'\\]*)*\'|[\$\w]+/g))}function c(n,t){t=t||"o";return n.replace(/\"[^"\\]*(?:\\.[^"\\]*)*\"|\'[^'\\]*(?:\\.[^'\\]*)*\'|[a-zA-Z\$]+([\w\$\.]*(\[.*\])*)*/g,function(n){return h(n)?n:n=="this"?t:a(n)+"("+t+")"})}function r(n){function i(n){if(n<0)return r;var u="oktmpl.filter."+t[n];return u.replace(/\(.*\)/,function(n){return"("+c(n.substring(1,n.length-1))+")"}).replace(/\(|$/,function(t){return"("+i(n-1)+(t=="("?",":")")})}var t=n.split("::"),r=c(t.shift());return i(t.length-1)}function v(t,i){for(var a=/{\{[^\}]+\}\}|\$\$[\w\-]+.+/g,f="",h=0,c,u,l,e,v;c=a.exec(t);)u=c[0],f+=s(t.substring(h,c.index)),o(u,"{{")?(l=o(u,"{{raw:"),e=r(l?u.substring(6,u.length-2):u.substring(2,u.length-2)),l||(e="oktmpl.htmlEncode("+e+")"),f+='" + ('+e+') + "'):(v=u.match(/\$\$\S+/)[0],f+=n[v](u,i)),h=a.lastIndex;return f+s(t.substring(h))}function y(n){var t=new l;return n='(function(o, c) { var out = "'+v(n,t)+'"; return out; })',t.wait().then(function(){return eval(n)})}function e(n){return function(t){return t?{toString:function(){return n}}:""}}var n={},u={},f={},i={filter:{},plugin:n,promise:t,cache:f,htmlEncode:function(n){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"};return n&&n.replace?n.replace(/&(?!#?\w+;)|<|>|"|'|\//g,function(n){return t[n]||n}):n},clone:function(n){function t(){}return t.prototype=n,new t},render:function(n,t){return this.compiledView(n).then(function(n){return n(t)})},compiledView:function(n){var i=f[n];return i?new t(i):this.fetchView(n).then(function(n){return y(n)}).then(function(t){return f[n]=t})},addView:function(n,t){if(typeof n=="string")u[n]=t;else for(var i in n)u[i]=n[i]},fetchView:function(n){var i=u[n];return delete u[n],new t(i)}};n.$$if=function(n,t){return t.close()+"if ("+t.scopedExpr(n.substring(4))+") { "+t.open()};n["$$else-if"]=function(n,t){return t.close()+"} else if ("+t.scopedExpr(n.substring(9))+") { "+t.open()};n.$$else=function(n,t){return t.close()+"} else {"+t.open()};n["$$end-if"]=function(n,t){return t.close()+"}"+t.open()};n.$$for=function(n,t){var i=/\sin\s/.exec(n),f=n.substring(5,i.index),u=f.match(/[\w\$\d]+/g),e=u[0],o=u.length>1?u[1]:"$index",s=r(n.substring(i.index+i[0].length));return t.close()+"(function(o) {var obj = o, arr = "+s+';if (!arr) return "";for (var i=0; i<arr.length; ++i) {o = oktmpl.clone(obj);o["'+e+'"]=arr[i];o["'+o+'"]=i;'+t.open()};n["$$end-for"]=function(n,t){return t.close()+"} })(o);"+t.open()};n.$$partial=function(n,t,u){var s=/(["'])(?:\\?.)*?\1/.exec(n),f=s[0],e,o;return f=f.substring(1,f.length-1),e=n.substring(s.index+f.length+3).replace(/\s/g,""),o=e.indexOf(":")>=0?"{"+e.replace(/\:\s*[a-zA-Z\$]+([\w\$\.]*(\[.*\])*)*/g,function(n){return":"+r(n.substring(1))})+"}":e.length?r(e):"o",t.addPromise(i.compiledView(f)),u?u(f,o):'" + oktmpl.cache["'+f+'"]('+o+') + "'};n.$$master=function(t,i){return n.$$partial(t,i,function(n,t){return'" + oktmpl.cache["'+n+'"]('+t+', function (o) { var out = "'})};n["$$master-body"]=function(){return'" + (c ? c(o) : "") + "'};n["$$end-master"]=function(){return'"; return out; }) + "'};i.filter.checked=e('checked="checked"');i.filter.selected=e('selected="selected"');i.filter.disabled=e('disabled="disabled"');window.oktmpl=i})();